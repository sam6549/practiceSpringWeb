CREATE SEQUENCE SEQ_BOARD;

CREATE TABLE TBL_BOARD (
	BNO NUMBER(10,0),
	TITLE VARCHAR2(200) NOT NULL,
	CONTENT VARCHAR2(2000) NOT NULL,
	WRITER VARCHAR2(50) NOT NULL,
	REGDATE DATE DEFAULT SYSDATE,
	UPDATEDATE DATE DEFAULT SYSDATE
);

ALTER TABLE TBL_BOARD ADD CONSTRAINT PK_BOARD
PRIMARY KEY (BNO);

INSERT INTO TBL_BOARD(BNO, TITLE, CONTENT, WRITER)
VALUES (SEQ_BOARD.NEXTVAL, '테스트 제목', '테스트 내용', 'user00');

--재귀복사를 통해서 데이터의 개수를 늘린다. 반복해서 여러번 실행
INSERT INTO TBL_BOARD (BNO,TITLE,CONTENT,WRITER)
(SELECT SEQ_BOARD.NEXTVAL, TITLE, CONTENT, WRITER FROM TBL_BOARD);


CREATE TABLE TBL_REPLY(
	RNO NUMBER(10,0),
	BNO NUMBER(10,0) NOT NULL,
	REPLY VARCHAR2(1000) NOT NULL,
	REPLYER VARCHAR2(50) NOT NULL,
	REPLYDATE DATE DEFAULT SYSDATE,
	UPDATEDATE DATE DEFAULT SYSDATE
);

CREATE SEQUENCE SEQ_REPLY;

ALTER TABLE TBL_REPLY ADD CONSTRAINT PK_REPLY PRIMARY KEY (RNO);

ALTER TABLE TBL_REPLY ADD CONSTRAINT FK_REPLY_BOARD
FOREIGN KEY (BNO) REFERENCES TBL_BOARD (BNO);

CREATE INDEX IDX_REPLY ON TBL_REPLY (BNO DESC, RNO ASC);

ALTER TABLE TBL_BOARD ADD (REPLYCNT NUMBER DEFAULT 0);
UPDATE TBL_BOARD SET REPLYCNT = (SELECT COUNT(RNO) FROM TBL_REPLY WHERE TBL_REPLY.BNO = TBL_BOARD.BNO);
